# base-client

_WARNING: Since 1.2.0, this package has required Node 18_

_Since 3.0.0, this package does not contain the [Google Auth Base Client](https://github.com/noah-ai/requests/tree/main/package/google-auth-base-client) or auto add [tracer headers](https://github.com/noah-ai/requests/tree/main/package/tracer-request-headers) due to frontend compatability_

A base client class for making API requests

```ts
import { BaseClient } from '@noah-ai/base-client';

class ExampleClient extends BaseClient {
  constructor() {
    super('https://url.com', async (url: string) => {
      // return auth headers here
    });
  }

  function getSomething(): string {
    return await this.get<string>('/url-path', {query_string: 'something'});
  }

  function postSomething(): string {
    return await this.post<string>(
      '/url-path',
      { woo: 'yay'}, // json object
      { headers: { custom_header: 'test' } }
    );
  }

  function postSomethingRaw(): string {
    return await this.rawPost<string>(
      '/url-path',
      { headers: { custom_header: 'test' }, body: new FormData() }
    );
  }
}
```

You can also override the `getAuthenticationHeaders` instead of providing it in the constructor:

```ts
class ExampleClient extends BaseClient {
  constructor() {
    super('https://url.com')
  }

  protected override async getAuthenticationHeaders(): Promise<
    Record<string, string>
  > {
     // return auth headers here
  }

  function getSomething(): string {
    return await this.get<string>('/url-path', {query_string: 'something'});
  }
}
```

# Client Factory

The `ClientFactory` abstract class can be used to store different versions of a client based on the input to its `getClient` method. This allows you to not recreate a client each time you need to get it within your code.

```ts
import { ClientFactory } from '@noah-ai/base-client';

class DeveloperApiClientFactory extends ClientFactory<
  DeveloperApiClient,
  GetDeveloperApiClientInput
> {
  constructor(
    private api_url: string,
    private auth_client_factory: DeveloperApiAuthClientFactory,
  ) {
    super();
  }

  // the key string used to store our clients against
  protected override transformInputToClientStoreKey(
    input: GetDeveloperApiClientInput,
  ): string {
    return input.client_id;
  }

  // the method used to create new clients for non-stored keys
  protected override createNewClient(
    input: GetDeveloperApiClientInput,
  ): DeveloperApiClient {
    return new DeveloperApiClient(
      new DeveloperApiBaseClient(
        this.api_url,
        this.auth_client_factory.getDeveloperApiAuthClient(input.auth),
      ),
    );
  }
}
```

This class can now be used to get your desired client:

```ts
const clientFactory = new DeveloperApiClientFactory(API_URL, authClientFactory);
const client = clientFactory.getClient({ client_id: 'woo' });
```
